## å®éªŒç®€ä»‹

### Chat Data

`Chat Data` æŠ€æœ¯å…è®¸ç”¨æˆ·é€šè¿‡è‡ªç„¶è¯­è¨€å¯¹è¯ä¸æ•°æ®ç³»ç»Ÿè¿›è¡Œäº’åŠ¨ã€‚ç”¨æˆ·å¯ä»¥æå‡ºé—®é¢˜æˆ–è¯·æ±‚ï¼Œç³»ç»Ÿæ ¹æ®ç”¨æˆ·çš„æ„å›¾å’Œå†å²äº¤äº’è®°å½•ï¼Œè‡ªåŠ¨ç”Ÿæˆå¯¹æ•°æ®ç³»ç»Ÿçš„æŸ¥è¯¢ã€ç®¡ç†æ“ä½œï¼Œå¹¶è¿›ä¸€æ­¥æä¾›æ•°æ®å¯è§†åŒ–ã€åˆ†æèƒ½åŠ›ã€‚

é’ˆå¯¹å…³ç³»å‹æ•°æ®åº“åœºæ™¯æ¥è¯´ï¼Œ`Text2SQL` æ˜¯ `Chat Data` çš„æŠ€æœ¯æ ¸å¿ƒï¼Œå…¶ç›®çš„æ˜¯å°†è‡ªç„¶è¯­è¨€æŸ¥è¯¢è½¬æ¢ä¸º SQLã€‚ç”¨æˆ·å¯ä»¥ç”¨ç®€å•çš„è‡ªç„¶è¯­è¨€æè¿°ä»–ä»¬æƒ³è¦æå–çš„æ•°æ®ï¼Œæ¯”å¦‚â€œæ˜¾ç¤º2023å¹´é”€å”®é¢æœ€é«˜çš„äº§å“â€ï¼Œç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨è§£æå¹¶ç”Ÿæˆç›¸åº”çš„ SQL è¯­å¥ï¼Œæ¯”å¦‚ `SELECT product_name FROM sales WHERE year = 2023 ORDER BY sales_amount DESC LIMIT 1;` ã€‚è¿™ç§æŠ€æœ¯åœ¨æ•°æ®åº“æŸ¥è¯¢ã€å•†ä¸šæ™ºèƒ½å’Œæ•°æ®åˆ†æå·¥å…·ä¸­å°¤ä¸ºé‡è¦ï¼Œä½¿å¾—éæŠ€æœ¯ç”¨æˆ·ä¹Ÿèƒ½è½»æ¾è¿›è¡Œå¤æ‚çš„æ•°æ®æŸ¥è¯¢ã€‚

`DB-GPT Chat Data` åº”ç”¨æ•ˆæœï¼š

![chatdata_example](./images/chat_data_example.png)

### GraphRAG

ä¼ ç»Ÿ `RAG` é€šå¸¸ä½¿ç”¨å‘é‡æ£€ç´¢ä½œä¸ºæ–‡æ¡£å¬å›å™¨ï¼Œåœ¨æ£€ç´¢ç²¾ç¡®åº¦æ–¹é¢å…·æœ‰ä¸€å®šçš„ä¼˜åŠ¿ï¼Œç„¶è€Œåœ¨å¤„ç†è¯¸å¦‚ â€œè¿™ç¯‡æ–‡ç« çš„ä¸»é¢˜æ˜¯ä»€ä¹ˆï¼Ÿâ€ã€â€œæ€»ç»“ä¸€ä¸‹æ–‡æ¡£â€ ç­‰æ¦‚æ‹¬æ€§ã€ç»¼åˆæ€§é—®é¢˜æ—¶å­˜åœ¨å›°éš¾ï¼Œè¿™äº›é—®é¢˜é€šå¸¸æ¶‰åŠå¤šä¸ªæ–‡æ¡£çŸ¥è¯†çš„æ•´åˆï¼Œè¦æ±‚æ–‡æ¡£æœç´¢çš„å¹¿åº¦è€Œéç²¾ç¡®åº¦ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ`GraphRAG` è¢«æå‡ºã€‚è¯¥æŠ€æœ¯åˆ›æ–°åœ°æå‡ºä½¿ç”¨å›¾ç»“æ„å­˜å‚¨å¤–éƒ¨çŸ¥è¯†ï¼Œå¤–éƒ¨çŸ¥è¯†é€šå¸¸æ˜¯"ä¸»-è°“-å®¾"ç»“æ„çš„ï¼Œè€Œå›¾ç»“æ„çš„èŠ‚ç‚¹å¯ä»¥æè¿°ä¸»è¯­å’Œå®¾è¯­ï¼Œå›¾ä¸­çš„è¾¹å¯ä»¥æè¿°è°“è¯­ï¼Œ`GraphRAG` ç¬¦åˆçŸ¥è¯†å»ºæ¨¡ï¼Œä»è€Œæœ‰æ•ˆæå‡æ–‡æ¡£å¬å›å’Œå›ç­”è´¨é‡ï¼›æ­¤å¤–ï¼Œç¤¾åŒºåˆ’åˆ†å’Œæ€»ç»“ä½¿å¾—åœ¨æ£€ç´¢æ—¶è€ƒè™‘é«˜å±‚çº§çš„ç»¼åˆæ€§çŸ¥è¯†ï¼Œåœ¨ä¿è¯æœç´¢ç²¾åº¦çš„åŒæ—¶ï¼Œæå‡æœç´¢çš„å¹¿åº¦ã€‚

`DB-GPT GraphRAG` åº”ç”¨æ•ˆæœï¼š

![graphrag_example](./images/chat_kb_example.png)

## å®éªŒèƒŒæ™¯

ğŸ¤–ï¸ **[DB-GPT](https://github.com/eosphoros-ai/DB-GPT)æ˜¯ä¸€ä¸ªå¼€æºçš„AIåŸç”Ÿæ•°æ®åº”ç”¨å¼€å‘æ¡†æ¶(AI Native Data App Development framework with AWEL(Agentic Workflow Expression Language) and Agents)ã€‚**

ç›®çš„æ˜¯æ„å»ºå¤§æ¨¡å‹é¢†åŸŸçš„åŸºç¡€è®¾æ–½ï¼Œé€šè¿‡å¼€å‘å¤šæ¨¡å‹ç®¡ç†(SMMF)ã€Text2SQLæ•ˆæœä¼˜åŒ–ã€RAGæ¡†æ¶ä»¥åŠä¼˜åŒ–ã€Multi-Agentsæ¡†æ¶åä½œã€AWEL(æ™ºèƒ½ä½“å·¥ä½œæµç¼–æ’)ç­‰å¤šç§æŠ€æœ¯èƒ½åŠ›ï¼Œè®©å›´ç»•æ•°æ®åº“æ„å»ºå¤§æ¨¡å‹åº”ç”¨æ›´ç®€å•ï¼Œæ›´æ–¹ä¾¿ã€‚ 

[OceanBase](https://github.com/oceanbase/oceanbase) ä» 4.3.3 ç‰ˆæœ¬å¼€å§‹æ”¯æŒäº†å‘é‡æ•°æ®ç±»å‹çš„å­˜å‚¨å’Œæ£€ç´¢ï¼Œå¹¶ä¸”ç»è¿‡é€‚é…å¯ä»¥ä½œä¸º DB-GPT çš„å¯é€‰å‘é‡æ•°æ®åº“ï¼Œæ”¯æŒ DB-GPT å¯¹ç»“æ„åŒ–æ•°æ®å’Œå‘é‡æ•°æ®çš„å­˜å–éœ€æ±‚ï¼Œæœ‰åŠ›åœ°æ”¯æ’‘å…¶ä¸Š LLM åº”ç”¨çš„å¼€å‘å’Œè½åœ°ï¼ŒåŒæ—¶ DB-GPT ä¹Ÿé€šè¿‡ `chat data`ã€`chat db` ç­‰åº”ç”¨ä¸º OceanBase æå‡æ˜“ç”¨æ€§ã€‚

é‰´äºä¼ ç»Ÿ RAG åœ¨æ¦‚æ‹¬æ€§é—®é¢˜ä¸Šå­˜åœ¨çš„é—®é¢˜ï¼ŒDB-GPT å®ç°äº†ä¸€ç§åŸºäºçŸ¥è¯†å›¾è°±è¿›è¡Œç›¸å…³æ–‡æ¡£å¬å›çš„ RAG æŠ€æœ¯ â€”â€” GraphRAGã€‚å®ç°ä¾èµ–å›¾æ•°æ®åº“å’Œå‘é‡æ•°æ®åº“ä½œä¸ºæ–‡æ¡£æ•°æ®å­˜å‚¨å’Œæ£€ç´¢çš„åŸºç¡€ç»„ä»¶ã€‚[TuGraph](https://github.com/tuGraph-family/tugraph-db)æ˜¯ä½œä¸ºä¸€ä¸ªé«˜æ•ˆçš„å›¾å½¢æ•°æ®åº“ï¼Œæ”¯æŒé«˜æ•°æ®é‡ã€ä½å»¶è¿ŸæŸ¥æ‰¾å’Œå¿«é€Ÿå›¾å½¢åˆ†æçš„å›¾æ•°æ®åº“ï¼Œå¯ä»¥ä¸ OceanBase çš„å‘é‡å­˜å‚¨åŠŸèƒ½ç›¸ç»“åˆï¼Œå…±åŒæ”¯æŒ DB-GPT GraphRAG åŠŸèƒ½ã€‚

## æŠ€æœ¯ç®€ä»‹

### Chat Data / NL2SQL / Text2SQL

DB-GPT çš„ `chat data` åŠŸèƒ½æœ¬è´¨æ˜¯è‡ªç„¶è¯­è¨€è½¬SQLæŠ€æœ¯ï¼ˆæˆ–ç§°ä¸º`NL2SQL`/`Text2SQL`ï¼‰ï¼ŒåŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

**æ•°æ®å¯¼å…¥é˜¶æ®µ**

1. è·å–æ•°æ®åº“å†…ç”¨æˆ·è¡¨schema
2. å°†è¡¨åã€åˆ—åã€çº¦æŸç­‰åµŒå…¥ä¸ºå‘é‡
3. å­˜å‚¨åˆ°OceanBaseå‘é‡æ•°æ®åº“

![chat dataæ•°æ®é¢„å¤„ç†](images/chat_data_pre.png)

**è‡ªç„¶è¯­è¨€æŸ¥è¯¢é˜¶æ®µ**

1. æé—®åµŒå…¥+å‘é‡æœç´¢
2. è·å–ç›¸å…³è¡¨schemaåç”ŸæˆSQLä»¥åŠå¯è§†åŒ–æ–¹æ¡ˆ
3. ä½¿ç”¨è·å–çš„æ•°æ®æœ€ç»ˆè¾“å‡º

![chat dataæŸ¥è¯¢é˜¶æ®µ](images/chat_data_search.png)

### GraphRAG

**æ•°æ®å¯¼å…¥é˜¶æ®µ**

1. æ–‡æ¡£åˆ†å—ï¼›
2. ä¾æ®æ–‡æ¡£å±‚çº§ç»“æ„ï¼Œä¸ºåˆ†å—å»ºç«‹çˆ¶å­å…³ç³»ï¼›
3. ä½¿ç”¨ LLM æŠ½å–æ–‡æ¡£å—ä¸­çš„å®ä½“ä»¥åŠå…³ç³»ä¸‰å…ƒç»„ï¼šåœ¨æ­¤è¿‡ç¨‹ä¸­ä½¿ç”¨å‘é‡æ•°æ®åº“æœç´¢å‡ºä¸å½“å‰å¤„ç†æ–‡æ¡£å—è¯­ä¹‰æ¥è¿‘çš„å—ï¼Œå¢å¼ºæŠ½å–æ—¶å¤§æ¨¡å‹å¯¹ä¸Šä¸‹æ–‡çš„è¯­ä¹‰ç†è§£ï¼›
4. ä½¿ç”¨ç¤¾åŒºç®—æ³•è·å–å‡ºå®ä½“å…³ç³»å›¾ä¸­çš„å­å›¾åˆ’åˆ†ï¼Œåˆ©ç”¨å¤§æ¨¡å‹ä¸ºæ¯ä¸ªå­å›¾ç”Ÿæˆä¸€æ®µæ€»ç»“ï¼Œå‘é‡åŒ–åå­˜å…¥æ•°æ®åº“ï¼›

![graphragæ•°æ®é¢„å¤„ç†](images/graph_rag_pre.png)

**æŸ¥è¯¢é˜¶æ®µ**

1. é€šè¿‡ç¤¾åŒºæ€»ç»“çš„å‘é‡æ•°æ®åº“è·å–å‡ºä¸æŸ¥è¯¢é—®é¢˜ç›¸å…³çš„topKä¸ªç¤¾åŒºï¼›
2. å°†è¿™äº›æŸ¥è¯¢ç»“æœæ‹¼æ¥ä¸ºä¸€ä¸ªæ€»çš„summaryï¼Œè®© LLM æŠ½å–æŸ¥è¯¢æ‰€éœ€è¦çš„å…³é”®è¯ï¼›
3. è·å–åŒ…å«å…³é”®è¯çš„å®ä½“ã€ä»¥åŠå…¶ä¸€è·³çš„é‚»å±…å®ä½“ï¼›
4. è·å–æ–‡æ¡£å—ï¼Œå¹¶åœ¨ LLM çš„æç¤ºè¯ä¸­æ·»åŠ å®ä½“ã€å…³ç³»çš„æè¿°ï¼›

![graphragæŸ¥è¯¢é˜¶æ®µ](images/graph_rag_search.png)

## å®éªŒç¯å¢ƒ

> ç°åœºä½“éªŒçš„ç”¨æˆ·ï¼Œæ— éœ€è¿›è¡Œç¯å¢ƒé…ç½®

- Git
- [Docker](https://docs.docker.com/engine/install/)
- MySQL å®¢æˆ·ç«¯ï¼ˆ[å¦‚ä½•å®‰è£…](https://www.modb.pro/db/1681843673074589696)ï¼‰

## å¹³å°æ­å»ºæ­¥éª¤

### 1. è·å– OceanBase / TuGraph æ•°æ®åº“

è¿›è¡Œå®éªŒä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè·å– OceanBase æ•°æ®åº“ï¼Œç›®å‰å¯è¡Œçš„æ–¹å¼æœ‰ä¸¤ç§ï¼šä½¿ç”¨ OBCloud å®ä¾‹æˆ–è€…[ä½¿ç”¨ Docker æœ¬åœ°éƒ¨ç½²å•æœºç‰ˆ OceanBase æ•°æ®åº“](#ä½¿ç”¨-docker-éƒ¨ç½²å•æœºç‰ˆ-oceanbase-æ•°æ®åº“)ã€‚æˆ‘ä»¬åœ¨æ­¤æ¨è OBCloud å®ä¾‹ï¼Œå› ä¸ºå®ƒéƒ¨ç½²å’Œç®¡ç†éƒ½æ›´åŠ ç®€å•ï¼Œä¸”ä¸éœ€è¦æœ¬åœ°ç¯å¢ƒæ”¯æŒã€‚

#### 1.1 æ³¨å†Œå¹¶å¼€é€š OBCloud å®ä¾‹

è¿›å…¥[OB Cloud äº‘æ•°æ®åº“ 365 å¤©å…è´¹è¯•ç”¨](https://www.oceanbase.com/free-trial?utm_source=ai)é¡µé¢ï¼Œç‚¹å‡»â€œç«‹å³è¯•ç”¨â€æŒ‰é’®ï¼Œæ³¨å†Œå¹¶ç™»å½•è´¦å·ï¼Œå¡«å†™ç›¸å…³ä¿¡æ¯ï¼Œå¼€é€šå®ä¾‹ï¼Œç­‰å¾…åˆ›å»ºå®Œæˆã€‚

#### 1.2 è·å–æ•°æ®åº“å®ä¾‹è¿æ¥ä¸²

è¿›å…¥å®ä¾‹è¯¦æƒ…é¡µçš„â€œå®ä¾‹å·¥ä½œå°â€ï¼Œç‚¹å‡»â€œè¿æ¥â€-â€œè·å–è¿æ¥ä¸²â€æŒ‰é’®æ¥è·å–æ•°æ®åº“è¿æ¥ä¸²ï¼Œå°†å…¶ä¸­çš„è¿æ¥ä¿¡æ¯å¡«å…¥åç»­æ­¥éª¤ä¸­åˆ›å»ºçš„ .env æ–‡ä»¶å†…ã€‚

![è·å–æ•°æ®åº“è¿æ¥ä¸²](images/get-connection-info.png)

#### 1.3 åˆ›å»ºæ•°æ®åº“

åˆ›å»ºæ•°æ®åº“ä»¥å­˜æ”¾ç¤ºä¾‹æ•°æ®ä»¥åŠå‘é‡æ•°æ®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è®¾ç½®æ•°æ®åº“åç§°çš„æ—¶å€™ï¼Œä¸ºäº†ä¾¿äºç”¨æˆ·åœ¨ DB-GPT å‰ç«¯ç•Œé¢è¿›è¡Œåç»­çš„æ“ä½œï¼Œ**å¼ºçƒˆä¸å»ºè®®ç”¨æˆ·ä½¿ç”¨ä»¥ä¸‹å››ç§åç§°**ï¼šï¼ˆå› ä¸ºä»¥ä¸‹å››ç§æ•°æ®åº“åè¢« DB-GPT ä¿ç•™ï¼Œç”¨æˆ·è™½ç„¶èƒ½æˆåŠŸåœ¨ DB-GPT ä¾§å»ºç«‹è¿æ¥ï¼Œä½†æ˜¯æ— æ³•åœ¨ Web UI ä¸­è¿›è¡Œåç»­çš„åº”ç”¨ç®¡ç†æ“ä½œï¼‰

- auth
- dbgpt
- test
- public

![åˆ›å»ºæ•°æ®åº“](images/create-db.png)

#### 1.4 æ‹‰å– TuGraph é•œåƒ

> ç°åœºä½“éªŒçš„ç”¨æˆ·ï¼Œæ— éœ€æ‹‰å–ï¼Œè¯·è·³è¿‡æœ¬æ­¥éª¤

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å–ï¼š

```bash
docker pull quay.io/oceanbase-devhub/tugraph-runtime-centos7:4.5.0
```

### 2. ç”³è¯·æ¨¡å‹ API KEY

åœ¨è¯¥åç»­æ­¥éª¤å½“ä¸­æˆ‘ä»¬å°†ä½¿ç”¨é˜¿é‡Œäº‘ç™¾ç‚¼çš„æ¨¡å‹æœåŠ¡ï¼Œæ‰€ä»¥éœ€è¦äº‹å…ˆç”³è¯· API KEYã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ³¨å†Œ[é˜¿é‡Œäº‘ç™¾ç‚¼](https://bailian.console.aliyun.com/)è´¦å·ï¼Œå¼€é€šæ¨¡å‹è°ƒç”¨æœåŠ¡å¹¶è·å– API Key

![å¼€é€šç™¾ç‚¼æ¨¡å‹è°ƒç”¨æœåŠ¡](images/bailian-model-call-1.png)

![å¼€é€šç™¾ç‚¼æ¨¡å‹è°ƒç”¨æœåŠ¡](images/bailian-model-call-2.png)

![è·å–ç™¾ç‚¼ API KEY](images/bailian-get-api-key-1.png)

![è·å–ç™¾ç‚¼ API KEY](images/bailian-get-api-key-2.png)

### 3. å…‹éš†é¡¹ç›®

> ç°åœºä½“éªŒçš„ç”¨æˆ·ï¼Œè¯·åœ¨ç™»å½•ä¸Šäº‘æœåŠ¡å™¨åï¼Œè·³è½¬åˆ°[5. å¯åŠ¨ Docker å®¹å™¨](#5-å¯åŠ¨-docker-å®¹å™¨)

ä¸ºäº†ç®€åŒ–éƒ¨ç½²æµç¨‹ï¼Œæˆ‘ä»¬åŸºäº DB-GPT çš„ 0.6.2 ç‰ˆæœ¬è¿›è¡Œäº†ä¿®æ”¹ï¼Œå¹¶ä¸”ä¸Šä¼ åˆ°äº†æˆ‘ä»¬ fork çš„ä»£ç ä»“åº“ä¸­ã€‚ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ä¸‹è½½é¡¹ç›®ä»£ç ï¼š

```bash
git clone https://github.com/oceanbase-devhub/DB-GPT
```

å¦‚æœä¸Šè¿°å‘½ä»¤æ‰§è¡Œé‡åˆ°é—®é¢˜ï¼Œå¯èƒ½æ˜¯è®¿é—® github å­˜åœ¨å›°éš¾ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ä» gitee è·å–é¡¹ç›®ä»£ç ï¼š

```bash
git clone https://gitee.com/oceanbase-devhub/DB-GPT.git
```

### 4. æ‹‰å– Docker é•œåƒ

```bash
docker pull quay.io/oceanbase-devhub/dbgpt:latest
```

### 5. å¯åŠ¨ Docker å®¹å™¨

è¿›å…¥é¡¹ç›®ä»£ç æ‰€åœ¨çš„ç›®å½•ï¼ˆä»¥å…‹éš† DB-GPT é¡¹ç›®æ‰€åœ¨çš„ç›®å½•ä¸ºæ ¹ç›®å½•ï¼‰ï¼š

```bash
cd ./DB-GPT/docker/compose_examples
```

æ‰§è¡Œ `create_container_with_config_check.sh` è„šæœ¬ï¼š

```bash
./create_container_with_config_check.sh
```

ä¸‹é¢è¯·æŒ‰ç…§è„šæœ¬è¦æ±‚é€é¡¹å¡«å†™å‚æ•°é…ç½®ï¼š

![è®¾ç½®å¯åŠ¨å‚æ•°](images/config_setting.png)

> å¦‚æœæœ€åä¸€æ­¥æç¤º**é¢„å…ˆåœ¨DB-GPTä¸­åˆ›å»º OceanBase è¿æ¥å¤±è´¥ï¼Œè¯·ç¨åæ ¹æ®æ•™ç¨‹åœ¨ Web UI ä¸­è®¾ç½®**ï¼Œå¯ä»¥ç…§å¸¸è¿›è¡Œåç»­æ­¥éª¤ï¼Œåœ¨ä½¿ç”¨é˜¶æ®µ[æ‰‹åŠ¨é…ç½®æ•°æ®åº“](#åˆ›å»ºæ•°æ®åº“è¿æ¥) è¿æ¥å³å¯

è¯¥è„šæœ¬ä¼šåšå¦‚ä¸‹å‡ ä»¶äº‹ï¼š

* è¦æ±‚ç”¨æˆ·è®¾ç½®ç›¸å…³å‚æ•°ï¼Œè¾“å‡ºä¼šåŒ…å«å„é¡¹çš„å½“å‰å€¼ï¼Œå¦‚æœè®¤å¯å½“å‰å€¼ï¼Œå›è½¦è¿›è¡Œä¸‹ä¸€é¡¹ï¼›
* è®¾ç½®å®Œæ‰€æœ‰å‚æ•°åï¼Œé¦–å…ˆé€šè¿‡å°è¯•ä¸€æ¬¡ embedding æ“ä½œæ¥éªŒè¯ API KEY è®¾ç½®æ˜¯å¦æœ‰æ•ˆï¼›
* å¦‚æœ API KEY éªŒè¯é€šè¿‡ï¼Œæµ‹è¯•ä¸ OceanBase æ˜¯å¦è¿é€šï¼Œè¿é€šåˆ™ä¼šè¿›ä¸€æ­¥åˆå§‹åŒ–æµ‹è¯•æ•°æ®ï¼Œä»¥ä¾¿åç»­çš„å®éªŒæ­¥éª¤ï¼Œæµ‹è¯•æ•°æ®åŒ…æ‹¬å››ä¸ªè¡¨ï¼š
    
    1. usersï¼šè®°å½•äº†ç”¨æˆ·çš„å§“åå’Œé‚®ç®±ï¼›
    2. productsï¼šè®°å½•äº†äº§å“çš„åç§°å’Œä»·æ ¼ï¼›
    3. ordersï¼šè®°å½•äº†ç”¨æˆ·è´­ä¹°äº§å“çš„è®¢å•ä¿¡æ¯ï¼›
    4. plant_and_animal_tableï¼šè®°å½•äº†ä¸€äº›åŠ¨æ¤ç‰©åç§°ä»¥åŠè¿™äº›åç§°çš„å‘é‡è¡¨ç¤ºï¼›

* å¯åŠ¨ TuGraph å¹¶ç­‰å¾…å¯åŠ¨å®Œæ¯•ï¼›
* å¯åŠ¨ DB-GPT æœåŠ¡å¹¶ç­‰å¾…å¯åŠ¨å®Œæ¯•ï¼›
* å°è¯•å‘ DB-GPT é¢„å…ˆæ³¨å†Œå¥½ `chat data` åº”ç”¨éœ€è¦çš„æ•°æ®åº“è¿æ¥ï¼Œè„šæœ¬ä¸­ç›´æ¥ä½¿ç”¨ OceanBase ä½œä¸ºç›®æ ‡æ•°æ®åº“ï¼›

![æµ‹è¯•æ•°æ®](images/sample_data.png)

## è®¿é—® DB-GPT å¹³å°

é»˜è®¤æƒ…å†µä¸‹ï¼ŒDB-GPT çš„å‰ç«¯é¡µé¢ä¼šå¯åŠ¨åœ¨æœ¬æœºçš„`5670`ç«¯å£ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥é€šè¿‡è®¿é—®å½“å‰æœºå™¨çš„ IP æ¥è®¿é—® DB-GPT çš„ç•Œé¢ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘åœ¨ç¬”è®°æœ¬ä¸Šè¿è¡Œçš„è¯ï¼Œæˆ‘åœ¨æµè§ˆå™¨ä¸Šè®¿é—®`localhost`å³å¯ï¼ˆæˆ–è€…æ˜¯å†…ç½‘ IPï¼‰ï¼›å¦‚æœåœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½² DB-GPTï¼Œåˆ™éœ€è¦è®¿é—®æœåŠ¡å™¨çš„å…¬ç½‘ IPã€‚

åˆå§‹ç•Œé¢ä¸‹æ˜¯ä¸åŒ…å«åº”ç”¨çš„ï¼Œç‚¹å‡»`åº”ç”¨ç®¡ç†`è¿›å…¥åˆ›å»ºæµç¨‹ï¼š

![DB-GPT åˆå§‹ç•Œé¢](images/init_page.png)

æ¥ä¸‹æ¥å°†æ¼”ç¤ºå¦‚ä½•åˆ›å»ºä¸¤ç§åº”ç”¨ç±»å‹ï¼š

1. å…¸å‹çš„çŸ¥è¯†åº“ `RAG` åº”ç”¨ï¼›
2. åŸºäº `text2SQL` çš„ `chat data` åº”ç”¨ï¼›

### åˆ›å»ºçŸ¥è¯†åº“

é¦–å…ˆé€‰æ‹©`çŸ¥è¯†åº“`ï¼Œå†ç‚¹å‡»`åˆ›å»ºçŸ¥è¯†åº“`ï¼š

![DB-GPT çŸ¥è¯†åº“1](images/knowledge_create_1.png)

ç„¶åæŒ‰ç…§é…ç½®å¼•å¯¼è¿›è¡Œè®¾ç½®ï¼š

çŸ¥è¯†åº“åç§°ã€æè¿°å¯è‡ªå®šä¹‰ã€‚**æœ¬æ•™ç¨‹é»˜è®¤æ¼”ç¤º GraphRAG åŠŸèƒ½ï¼Œæ‰€ä»¥å­˜å‚¨ç±»å‹é€‰æ‹©ä¸º`Knowldege Graph`ï¼Œå¦‚éœ€ä½¿ç”¨å®Œå…¨åŸºäºå‘é‡æœç´¢çš„ä¼ ç»Ÿ RAG è¯·é€‰æ‹©å­˜å‚¨ç±»å‹ä¸º`Vector Store`ã€‚**
![DB-GPT çŸ¥è¯†åº“2](images/knowledge_create_2.png)

è¿™é‡Œæˆ‘é€‰æ‹©æ™®é€šæ–‡æ¡£ä½œä¸ºç¤ºä¾‹ï¼Œç”¨æˆ·å¯è‡ªè¡Œå°è¯•å…¶ä»–ç±»å‹ã€‚
![DB-GPT çŸ¥è¯†åº“3](images/knowledge_create_3.png)

ç‚¹å‡»`é€‰æ‹©æˆ–æ‹–æ‹½æ–‡ä»¶`åŒºåŸŸï¼Œé€‰æ‹©ç¬¦åˆæ ¼å¼è¦æ±‚çš„æ–‡ä»¶
![DB-GPT çŸ¥è¯†åº“4](images/knowledge_create_4.png)

é»˜è®¤é€‰æ‹©`è‡ªåŠ¨åˆ‡ç‰‡`ï¼Œç‚¹å‡»`åˆ‡ç‰‡å¤„ç†`å³å¯ã€‚è€å¿ƒç­‰å¾…å¤„ç†å®Œæˆï¼Œå¤„ç†ä¼šè‡ªåŠ¨é€€å‡ºé…ç½®ç•Œé¢ï¼Œå¹¶å¼¹å‡ºæˆåŠŸæ¶ˆæ¯ã€‚**éœ€è¦æ³¨æ„çš„æ˜¯ GraphRAG ç›¸å¯¹äºä¼ ç»Ÿçš„ RAG æ¥è¯´åœ¨å¯¼å…¥æ–‡æ¡£ã€æ„å»ºç´¢å¼•éƒ¨åˆ†ç›¸å¯¹è€—æ—¶ï¼Œè¯·è€å¿ƒç­‰å¾…ï¼Œæ„Ÿå…´è¶£çš„ç”¨æˆ·å¯ä»¥åœ¨æœåŠ¡éƒ¨ç½²æœºå™¨ä¸Šä½¿ç”¨`docker logs -f dbgpt`å‘½ä»¤æŸ¥çœ‹å¤„ç†è¿‡ç¨‹çš„æ—¥å¿—**
![DB-GPT çŸ¥è¯†åº“5](images/knowledge_create_5.png)

ç„¶åç‚¹å‡»åˆ›å»ºå¥½çš„çŸ¥è¯†åº“ï¼Œç‚¹å‡»`æŸ¥çœ‹å›¾è°±`ï¼Œå¯ä»¥çœ‹åˆ°æ–‡æ¡£ç»è¿‡å¤„ç†åçš„å®ä½“-å…³ç³»å›¾ï¼š
![DB-GPT çŸ¥è¯†åº“6](images/view_graph_1.png)
![DB-GPT çŸ¥è¯†åº“7](images/view_graph_2.png)
![DB-GPT çŸ¥è¯†åº“8](images/view_graph_3.png)

### åˆ›å»ºæ•°æ®åº“è¿æ¥

> åœ¨[å¯åŠ¨ Docker å®¹å™¨](#5-å¯åŠ¨-docker-å®¹å™¨)æ­¥éª¤ï¼Œè¿è¡Œ`create_container_with_config_check.sh`è„šæœ¬å¾—åˆ°`é¢„å…ˆåœ¨DB-GPTä¸­åˆ›å»º OceanBase è¿æ¥æˆåŠŸ`æç¤ºçš„ç”¨æˆ·å¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ã€‚

ç‚¹å‡»`æ•°æ®åº“`ï¼Œé€‰æ‹©`OceanBase`æ•°æ®åº“ï¼Œ`Create Now`ï¼š

![æ•°æ®åº“è¿æ¥1](images/db_1.png)

æ ¹æ® `OceanBase` è¿æ¥ä¸²æä¾›çš„ä¿¡æ¯è®¾ç½®æ•°æ®åº“åã€ç”¨æˆ·åã€ä¸»æœºåœ°å€ã€ç«¯å£ç­‰ä¿¡æ¯ï¼ˆå¯ä»¥ä¸[5. å¯åŠ¨ Docker å®¹å™¨](#5-å¯åŠ¨-docker-å®¹å™¨)ä¸€è‡´ï¼‰

![æ•°æ®åº“è¿æ¥2](images/db_2.png)

åˆ›å»ºæˆåŠŸå³å¯åœ¨ä¾§è¾¹æ çœ‹åˆ°è¿æ¥ä¿¡æ¯ï¼š

![æ•°æ®åº“è¿æ¥3](images/db_3.png)

### åˆ›å»ºçŸ¥è¯†åº“åº”ç”¨å’Œ chat data åº”ç”¨

é€‰æ‹©`åº”ç”¨ç¨‹åº`ï¼Œç‚¹å‡»`åˆ›å»ºåº”ç”¨`ï¼š

![åˆ›å»ºåº”ç”¨](images/create_app1.png)

é€‰æ‹©`åŸç”Ÿåº”ç”¨æ¨¡å¼`ï¼Œåº”ç”¨åç§°å’Œæè¿°å¯è‡ªè¡Œå®šä¹‰ï¼š

![åˆ›å»ºçŸ¥è¯†åº“åº”ç”¨1](images/knowledge_app1.png)

åº”ç”¨ç±»å‹é€‰æ‹© `Chat Knowledge`ï¼Œå‚æ•°é€‰æ‹©æˆ‘ä»¬åˆšåˆšåˆ›å»ºå¥½çš„çŸ¥è¯†åº“åç§°ï¼Œæ¨¡å‹åœ¨æˆ‘ä»¬çš„é…ç½®ä¸‹ä»…æœ‰ `tongyi_proxyllm` å¯ä¾›é€‰æ‹©ï¼Œæ¸©åº¦æ§åˆ¶æ¨¡å‹è¾“å‡ºçš„éšæœºæ€§ï¼Œå€¼è¶Šå¤§ï¼Œæ¨¡å‹è¾“å‡ºè¶Šéšæœºã€‚è®¾ç½®å®Œæ¯•åä¿å­˜ï¼Œå°±å¯ä»¥çœ‹åˆ°åœ¨åº”ç”¨ç¨‹åºä¸€æ ä¸­å‡ºç°äº†æˆ‘ä»¬å®šä¹‰çš„åº”ç”¨ã€‚

![åˆ›å»ºçŸ¥è¯†åº“åº”ç”¨2](images/knowledge_app2.png)
![åˆ›å»ºçŸ¥è¯†åº“åº”ç”¨3](images/knowledge_app3.png)

ç„¶åæˆ‘ä»¬ç»§ç»­ç±»ä¼¼åœ°åˆ›å»º `chat data` åº”ç”¨ï¼š

![åˆ›å»ºchat dataåº”ç”¨1](images/chatdata_app1.png)

åº”ç”¨ç±»å‹é€‰æ‹© `Chat Data`ï¼Œå‚æ•°é€‰æ‹©æˆ‘ä»¬åˆšåˆšåˆ›å»ºå¥½çš„æ•°æ®åº“è¿æ¥ï¼Œæ¨¡å‹å’Œæ¸©åº¦å«ä¹‰ä¸ `Chat Knowledge` ä¸€è‡´ã€‚

![åˆ›å»ºchat dataåº”ç”¨2](images/chatdata_app2.png)

### ä½¿ç”¨åº”ç”¨

å›åˆ°`åº”ç”¨ç¨‹åº`é¡µé¢ï¼Œç‚¹å‡»å¼€å§‹å¯¹è¯å¯ä»¥è¿›å…¥ä½¿ç”¨æµç¨‹ï¼š

![ä½¿ç”¨åº”ç”¨](images/start_app.png)

çŸ¥è¯†åº“åº”ç”¨â€”â€”ç›´æ¥é”®å…¥æ–‡æœ¬è¿›è¡Œäº¤äº’å³å¯ï¼š

![çŸ¥è¯†åº“åº”ç”¨](images/knowledge_chat.png)

chat data åº”ç”¨å¯ä»¥ä½¿ç”¨è‡ªç„¶è¯­è¨€çš„æ–¹å¼å‘ŠçŸ¥å¤§æ¨¡å‹ç”Ÿæˆ SQLï¼Œå¹¶ä½¿ç”¨å¾—åˆ°çš„æ•°æ®è¿›è¡Œå¯è§†åŒ–ï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯ text2SQL å¯¹å¤§æ¨¡å‹çš„èƒ½åŠ›è¦æ±‚è¾ƒé«˜ï¼Œå¦‚æœæ‰§è¡Œç»“æœå‡ºç°é”™è¯¯æç¤ºï¼Œå¯ä»¥å°è¯•é‡è¯•å’Œä¿®æ”¹æç¤ºè¯ï¼‰ã€‚è¿™ä¸€éƒ¨åˆ†å¯ä»¥è¿›è¡Œäº¤äº’æŸ¥è¯¢çš„è¡¨ï¼Œè¯·å›é¡¾[5. å¯åŠ¨ Docker å®¹å™¨](#5-å¯åŠ¨-docker-å®¹å™¨)ï¼Œæˆ–è€…ç›´æ¥è¯¢é—®`æ•°æ®åº“æœ‰å“ªäº›è¡¨`ã€`xxxè¡¨çš„ç»“æ„å®šä¹‰`è·å–è¡¨çš„æ¨¡å¼ä¿¡æ¯ã€‚

![çŸ¥è¯†åº“åº”ç”¨](images/chat_data.png)

é¢å¤–æä¾›ä¸€äº›è¯¢é—®ä¾›ç”¨æˆ·å°è¯•ï¼š

1. æŸ¥è¯¢ä»·æ ¼è¶…è¿‡25çš„äº§å“ï¼Œå¹¶ç”¨æ¡å½¢å›¾å±•ç¤ºã€‚æ³¨æ„æŸ¥è¯¢ç»“æœä¸éœ€è¦åŒ…å«idåˆ—ï¼›
2. æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ï¼›
3. æŸ¥è¯¢æ¯ä¸ªç”¨æˆ·è´­ä¹°çš„äº§å“æ€»æ•°é‡ï¼›
4. æŸ¥è¯¢æ¯ä¸ªç”¨æˆ·è´­ä¹°çš„äº§å“åå’Œäº§å“æ•°é‡ï¼›
5. å¯è§†åŒ–ä¸€ä¸‹plant_and_animal_tableè¡¨çš„åç§°å‘é‡åˆ—ï¼Œå¹¶ä½¿ç”¨åç§°ä½œä¸ºå¯è§†åŒ–æ•°æ®ç‚¹çš„æ ‡ç­¾ã€‚ç”Ÿæˆçš„SQLä¸è¦åŒ…å«idåˆ—ï¼›

## é™„å½•

### ä½¿ç”¨ Docker éƒ¨ç½²å•æœºç‰ˆ OceanBase æ•°æ®åº“

#### 1. å¯åŠ¨ OceanBase å®¹å™¨

æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ä¸€ä¸ª OceanBase docker å®¹å™¨ï¼š

```bash
docker run --name=ob433 -e MODE=mini -e OB_MEMORY_LIMIT=8G -e OB_DATAFILE_SIZE=10G -e OB_CLUSTER_NAME=ailab2024_dbgpt -e OB_SERVER_IP=127.0.0.1 -p 2881:2881 -d quay.io/oceanbase/oceanbase-ce:4.3.3.1-101000012024102216
```

å¦‚æœä¸Šè¿°å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œå°†ä¼šæ‰“å°å®¹å™¨ IDï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```bash
af5b32e79dc2a862b5574d05a18c1b240dc5923f04435a0e0ec41d70d91a20ee
```

#### 2. æ£€æŸ¥ OceanBase æ•°æ®åº“åˆå§‹åŒ–æ˜¯å¦å®Œæˆ

å®¹å™¨å¯åŠ¨åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ OceanBase æ•°æ®åº“åˆå§‹åŒ–çŠ¶æ€ï¼š

```bash
docker logs -f ob433
```

åˆå§‹åŒ–è¿‡ç¨‹å¤§çº¦éœ€è¦ 2 ~ 3 åˆ†é’Ÿã€‚å½“æ‚¨çœ‹åˆ°ä»¥ä¸‹æ¶ˆæ¯ï¼ˆåº•éƒ¨çš„ `boot success!` æ˜¯å¿…é¡»çš„ï¼‰æ—¶ï¼Œè¯´æ˜ OceanBase æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼š

```bash
cluster scenario: express_oltp
Start observer ok
observer program health check ok
Connect to observer ok
Initialize oceanbase-ce ok
Wait for observer init ok
+----------------------------------------------+
|                 oceanbase-ce                 |
+------------+---------+------+-------+--------+
| ip         | version | port | zone  | status |
+------------+---------+------+-------+--------+
| 172.17.0.2 | 4.3.3.1 | 2881 | zone1 | ACTIVE |
+------------+---------+------+-------+--------+
obclient -h172.17.0.2 -P2881 -uroot -Doceanbase -A

cluster unique id: c17ea619-5a3e-5656-be07-00022aa5b154-19298807cfb-00030304

obcluster running

...

check tenant connectable
tenant is connectable
boot success!
```

ä½¿ç”¨ `Ctrl + C` é€€å‡ºæ—¥å¿—æŸ¥çœ‹ç•Œé¢ã€‚

#### 3. æµ‹è¯•æ•°æ®åº“éƒ¨ç½²æƒ…å†µï¼ˆå¯é€‰ï¼‰

å¯ä»¥ä½¿ç”¨ mysql å®¢æˆ·ç«¯è¿æ¥åˆ° OceanBase é›†ç¾¤ï¼Œæ£€æŸ¥æ•°æ®åº“éƒ¨ç½²æƒ…å†µã€‚

```bash
mysql -h127.0.0.1 -P2881 -uroot@test -A -e "show databases"
```

å¦‚æœéƒ¨ç½²æˆåŠŸï¼Œæ‚¨å°†çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š

```bash
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| oceanbase          |
| test               |
+--------------------+
```

#### 4. ä¿®æ”¹å‚æ•°å¯ç”¨å‘é‡æ¨¡å—

å¯é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å°†`test`ç§Ÿæˆ·ä¸‹çš„`ob_vector_memory_limit_percentage`å‚æ•°è®¾ç½®ä¸ºéé›¶å€¼ï¼Œä»¥å¼€å¯ OceanBase çš„å‘é‡åŠŸèƒ½æ¨¡å—ã€‚

```bash
mysql -h127.0.0.1 -P2881 -uroot@test -A -e "alter system set ob_vector_memory_limit_percentage = 30"
```
